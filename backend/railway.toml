[build]
builder = "nixpacks"

[deploy]
runtime = "V2"
numReplicas = 1
startCommand = "gunicorn app:app"
sleepApplication = false
healthcheckPath = "/health"
healthcheckTimeout = 100
multiRegionConfig = { "asia-southeast1-eqsg3a" = { numReplicas = 1 } }
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 2

[nixpacks]
aptPackages = ["libgl1-mesa-glx", "libglib2.0-0"]

[phases.setup]
nixPkgs = ["pkg-config"]

[phases.install]
dependsOn = ["setup"]
cmds = [
  "pip install --upgrade pip setuptools wheel",
  "pip install -r requirements.txt"
]
